<app-header></app-header>

<div class="container">
  <h1>рЃерЃћрЃЦрЃЏрЃћрЃюрЃў рЃљрЃ«рЃљрЃџрЃў рЃЊрЃљрЃЋрЃљрЃџрЃћрЃЉрЃљ</h1>
  <form [formGroup]="taskForm" (ngSubmit)="createTask()" class="form">
    <!-- рЃАрЃљрЃЌрЃљрЃБрЃарЃў -->
    <div class="dropdown-container">
      <label class="label">рЃАрЃљрЃЌрЃљрЃБрЃарЃў*</label>
      <input formControlName="title" class="custom-dropdown" />
      <div class="validation-messages">
        <p
          class="validation-text"
          [ngStyle]="{
            color:
              taskForm.controls['title'].value?.length >= 3 ? 'green' : 'gray'
          }"
        >
          рЃЏрЃўрЃюрЃўрЃЏрЃБрЃЏ 3 рЃАрЃўрЃЏрЃЉрЃЮрЃџрЃЮ
        </p>
        <p
          class="validation-text"
          [ngStyle]="{
            color:
              taskForm.controls['title'].value?.length <= 255 &&
              taskForm.controls['title'].value?.length > 0
                ? 'green'
                : 'gray'
          }"
        >
          рЃЏрЃљрЃЦрЃАрЃўрЃЏрЃБрЃЏ 255 рЃАрЃўрЃЏрЃЉрЃЮрЃџрЃЮ
        </p>
      </div>
    </div>

    <!-- рЃЊрЃћрЃърЃљрЃарЃбрЃљрЃЏрЃћрЃюрЃбрЃў -->
    <div class="dropdown-container" [class.open]="isDropdownOpen('department')">
      <label class="label">рЃЊрЃћрЃърЃљрЃарЃбрЃљрЃЏрЃћрЃюрЃбрЃў*</label>
      <div class="dropdown-wrapper">
        <div class="custom-dropdown" (click)="toggleDropdown('department')">
          <div class="selected-option">
            {{
              taskForm.get("department")?.value?.name || "рЃљрЃўрЃарЃЕрЃўрЃћрЃЌ рЃЊрЃћрЃърЃљрЃарЃбрЃљрЃЏрЃћрЃюрЃбрЃў"
            }}
          </div>
          <ion-icon
            name="chevron-down-outline"
            [class.rotate]="isDropdownOpen('department')"
          ></ion-icon>
        </div>
        <div class="dropdown-options" *ngIf="isDropdownOpen('department')">
          <div
            *ngFor="let department of departments()"
            class="dropdown-item"
            (click)="updateSelection('department', department.id)"
          >
            {{ department.name }}
          </div>
        </div>
      </div>
    </div>

    <!-- рЃљрЃдрЃгрЃћрЃарЃљ -->
    <div class="dropdown-container">
      <label class="label">рЃљрЃдрЃгрЃћрЃарЃљ</label>
      <textarea
        formControlName="description"
        class="custom-dropdown textarea"
      ></textarea>
      <div class="validation-messages">
        <p
          class="validation-text"
          [ngStyle]="{
            color:
              descriptionHasMinWords() &&
              taskForm.controls['description'].value?.length > 0
                ? 'green'
                : 'gray'
          }"
        >
          рЃЏрЃўрЃюрЃўрЃЏрЃБрЃЏ 4 рЃАрЃўрЃбрЃДрЃЋрЃљ
        </p>
        <p
          class="validation-text"
          [ngStyle]="{
            color:
              taskForm.controls['description'].value?.length <= 255 &&
              taskForm.controls['description'].value?.length > 0
                ? 'green'
                : 'gray'
          }"
        >
          рЃЏрЃљрЃЦрЃАрЃўрЃЏрЃБрЃЏ 255 рЃАрЃўрЃЏрЃЉрЃЮрЃџрЃЮ
        </p>
      </div>
    </div>

    <!-- рЃЌрЃљрЃюрЃљрЃЏрЃерЃарЃЮрЃЏрЃћрЃџрЃў -->
    <div class="dropdown-container" [class.open]="isDropdownOpen('employee')">
      <label class="label" [class.disabled]="!taskForm.get('department')?.value"
        >рЃърЃљрЃАрЃБрЃ«рЃўрЃАрЃЏрЃњрЃћрЃЉрЃћрЃџрЃў рЃЌрЃљрЃюрЃљрЃЏрЃерЃарЃЮрЃЏрЃћрЃџрЃў*</label
      >
      <div class="dropdown-wrapper">
        <div class="custom-dropdown" (click)="toggleDropdown('employee')">
          <div class="selected-option">
            {{
              taskForm.get("employee")?.value?.name || "рЃљрЃўрЃарЃЕрЃўрЃћрЃЌ рЃЌрЃљрЃюрЃљрЃЏрЃерЃарЃЮрЃЏрЃћрЃџрЃў"
            }}
          </div>
          <ion-icon
            name="chevron-down-outline"
            [class.rotate]="isDropdownOpen('employee')"
          ></ion-icon>
        </div>
        <div class="dropdown-options" *ngIf="isDropdownOpen('employee')">
          <div
            *ngFor="let employee of filteredEmployees()"
            class="dropdown-item"
            (click)="updateSelection('employee', employee.id)"
          >
            {{ employee.name }}
          </div>
        </div>
      </div>
    </div>

    <div class="side">
      <!-- рЃАрЃбрЃљрЃбрЃБрЃАрЃў  -->
      <div class="dropdown-container" [class.open]="isDropdownOpen('status')">
        <label class="label">рЃљрЃўрЃарЃЕрЃўрЃћрЃЌ*</label>

        <div class="dropdown-wrapper">
          <div class="custom-dropdown" (click)="toggleDropdown('status')">
            <div class="selected-option">
              {{ taskForm.get("status")?.value?.name || "рЃљрЃўрЃарЃЕрЃўрЃћрЃЌ рЃАрЃбрЃљрЃбрЃБрЃАрЃў" }}
            </div>
            <ion-icon
              name="chevron-down-outline"
              [class.rotate]="isDropdownOpen('status')"
            ></ion-icon>
          </div>
          <div class="dropdown-options" *ngIf="isDropdownOpen('status')">
            <div
              *ngFor="let status of statuses()"
              class="dropdown-item"
              (click)="updateSelection('status', status.id)"
            >
              {{ status.name }}
            </div>
          </div>
        </div>
      </div>
      <!-- рЃърЃарЃўрЃЮрЃарЃўрЃбрЃћрЃбрЃў -->
      <div class="dropdown-container" [class.open]="isDropdownOpen('priority')">
        <label class="label">рЃърЃарЃўрЃЮрЃарЃўрЃбрЃћрЃбрЃў*</label>
        <div class="dropdown-wrapper">
          <div class="custom-dropdown" (click)="toggleDropdown('priority')">
            <div class="selected-option">
              {{
                taskForm.get("priority")?.value?.name || "рЃљрЃўрЃарЃЕрЃўрЃћрЃЌ рЃърЃарЃўрЃЮрЃарЃўрЃбрЃћрЃбрЃў"
              }}
            </div>
            <ion-icon
              name="chevron-down-outline"
              [class.rotate]="isDropdownOpen('priority')"
            ></ion-icon>
          </div>
          <div class="dropdown-options" *ngIf="isDropdownOpen('priority')">
            <div
              *ngFor="let priority of priorities()"
              class="dropdown-item"
              (click)="updateSelection('priority', priority.id)"
            >
              {{ priority.name }}
            </div>
          </div>
        </div>
      </div>
    </div>
    <!-- рЃЎрЃљрЃџрЃћрЃюрЃЊрЃљрЃарЃў -->
    <div class="date-picker-container">
      <label for="dateField">рЃЌрЃљрЃарЃўрЃдрЃў</label>
      <div class="date-input-wrapper">
        <span class="calendar-icon" (click)="openCalendar()">­ЪЊЁ</span>
        <input
          type="date"
          id="dateField"
          class="date-input"
          placeholder="DD/MM/YYYY"
          formControlName="due_date"
          [min]="minDate"
          (change)="updateDate($event)"
          #dateInput
          required
        />
      </div>
    </div>

    <div class="button-container">
      <button
        type="submit"
        class="create-task-btn"
        [disabled]="taskForm.invalid"
      >
        рЃЊрЃљрЃЋрЃљрЃџрЃћрЃЉрЃўрЃА рЃерЃћрЃЦрЃЏрЃюрЃљ
      </button>
    </div>
  </form>
</div>
